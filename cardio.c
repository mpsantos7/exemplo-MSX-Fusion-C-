/*
Curva de Cardioide
usando tabela de senos e cossenos.
*/

#include "fusion-c/header/msx_fusion.h"
//#include "fusion-c/header/vdp_sprites.h"
#include "fusion-c/header/vdp_graph2.h"
#include <stdio.h>
//#include <stdlib.h>
//#include <math.h>

float sen_table[63][2] =
{
 {0., 0.},
 {1., 0.0998334},
 {2., 0.198669},
 {3., 0.29552},
 {4., 0.389418},
 {5., 0.479426},
 {6., 0.564642},
 {7., 0.644218},
 {8., 0.717356},
 {9., 0.783327},
 {10., 0.841471},
 {11., 0.891207},
 {12., 0.932039},
 {13., 0.963558},
 {14., 0.98545},
 {15., 0.997495},
 {16., 0.999574},
 {17., 0.991665},
 {18., 0.973848},
 {19., 0.9463},
 {20., 0.909297},
 {21., 0.863209},
 {22., 0.808496},
 {23., 0.745705},
 {24., 0.675463},
 {25., 0.598472},
 {26., 0.515501},
 {27., 0.42738},
 {28., 0.334988},
 {29., 0.239249},
 {30., 0.14112},
 {31., 0.0415807},
 {32., -0.0583741},
 {33., -0.157746},
 {34., -0.255541},
 {35., -0.350783},
 {36., -0.44252},
 {37., -0.529836},
 {38., -0.611858},
 {39., -0.687766},
 {40., -0.756802},
 {41., -0.818277},
 {42., -0.871576},
 {43., -0.916166},
 {44., -0.951602},
 {45., -0.97753},
 {46., -0.993691},
 {47., -0.999923},
 {48., -0.996165},
 {49., -0.982453},
 {50., -0.958924},
 {51., -0.925815},
 {52., -0.883455},
 {53., -0.832267},
 {54., -0.772764},
 {55., -0.70554},
 {56., -0.631267},
 {57., -0.550686},
 {58., -0.464602},
 {59., -0.373877},
 {60., -0.279415},
 {61., -0.182163},
 {62., -0.0830894}
};

float cos_table[63] ={1., 0.995004, 0.980067, 0.955336, 0.921061, 0.877583, 0.825336, 
0.764842, 0.696707, 0.62161, 0.540302, 0.453596, 0.362358, 0.267499, 
0.169967, 0.0707372, -0.0291995, -0.128844, -0.227202, -0.32329, 
-0.416147, -0.504846, -0.588501, -0.666276, -0.737394, -0.801144, 
-0.856889, -0.904072, -0.942222, -0.970958, -0.989992, -0.999135, 
-0.998295, -0.98748, -0.966798, -0.936457, -0.896758, -0.8481, 
-0.790968, -0.725932, -0.653644, -0.574824, -0.490261, -0.400799, 
-0.307333, -0.210796, -0.112153, -0.0123887, 0.087499, 0.186512, 
0.283662, 0.377978, 0.468517, 0.554374, 0.634693, 0.70867, 0.775566, 
0.834713, 0.88552, 0.927478, 0.96017, 0.983268, 0.996542};

float raiz_quad_abs_cos[63] =
{ 1., 0.997499, 0.989983, 0.977413, 0.959719, 0.936794, 0.90848, 
0.874553, 0.83469, 0.788422, 0.735053, 0.673495, 0.601962, 0.517203, 
0.412271, 0.265965, 0.170879, 0.358949, 0.476657, 0.568586, 0.645094, 
0.710525, 0.767138, 0.816257, 0.858716, 0.895066, 0.925683, 0.950827, 
0.970681, 0.985372, 0.994984, 0.999567, 0.999147, 0.99372, 0.983259, 
0.967707, 0.946973, 0.920923, 0.889364, 0.852017, 0.808482, 0.758171, 
0.700186, 0.633087, 0.554376, 0.459125, 0.334892, 0.111304, 0.295802, 
0.431871, 0.532599, 0.614799, 0.684483, 0.744563, 0.796676, 0.841825, 
0.880662, 0.913626, 0.94102, 0.963057, 0.979883, 0.991599, 0.99827 };

unsigned int Raio_fun_theta(int valor_sen,int abs_sqcos) {
	unsigned int Raio = 32;
	unsigned int RaioTheta;
	RaioTheta = Raio*(valor_sen * abs_sqcos / (valor_sen + 140) -2* valor_sen +200 )/100;
	return RaioTheta;
}

void main(void){
	char i,x,y,Cor,CentroX,CentroY;
    int Raio,tempo_ini, tempo_fim, delta_t;
	int SinValor,CosValor;
    VDP60Hz();
	CentroX = 127, CentroY = 70; Cor = 6;
	Screen(5);
    KeySound(0);
    tempo_ini = RealTimer();
SetColors(Cor, 0, 0);
for (i = 0;i < 63;i++) {
    SinValor = (int)(100*sen_table[i][1]);
    CosValor = (int)(100*cos_table[i]);
    Raio = Raio_fun_theta(SinValor, (int)(100*raiz_quad_abs_cos[i]) );
    x = (char)((Raio * CosValor)/100 + CentroX);
    y = (char)(CentroY - (Raio * SinValor)/100);
    Pset(x, y, Cor, 0);
	//Line(x, y, xn, yn, Cor, 0);
    //if (Inkey() == 27)
    //	break; // Emergencia
}

tempo_fim = RealTimer();
while (Inkey() != 27) {}
// Ending program, and return to DOS
Screen(0);
SetColors(15, 0, 0);
KeySound(1);
delta_t = tempo_fim - tempo_ini;
//printf("tempo exec.= %d.%d s",(delta_t)/60,100*(delta_t%60)/60);
Print("tempo exec. = ");
PrintNumber((delta_t) / 60);
Print(",");
PrintNumber(100 * (delta_t % 60) / 60);
Exit(0);

}
